---
import members from '@/members.json';
import faviconManifest from '@/favicon-manifest.json';
import ExternalLink from '@/components/graphics/ExternalLink.svg';

const FALLBACK_FAVICON = '/favicon.png';

const getFaviconSrc = (website: string): string => {
	const entry = faviconManifest[website];
	// null = explicitly failed, undefined = not in manifest, string = valid path
	return typeof entry === 'string' ? entry : FALLBACK_FAVICON;
};
---

<>
	<div class="member-list">
		{
			members.slice(1).map((e) => (
				<a href={`https://${e.website}/`} class="member-container">
					<div style="display: flex; flex-direction: row; align-items: start; gap: 0.5rem">
						<div class="icon-container">
							<img
								src={getFaviconSrc(e.website)}
								onerror="this.onerror=null; this.src='/favicon.png';"
								alt={`${e.name} favicon`}
								class="favicon"
							/>
						</div>
						<div>
							<div style="display: flex; flex-direction: row; align-items: center; gap: 0.5rem">
								<p class="name">{e.name}</p>
								<ExternalLink
									width={'1.5ch'}
									height={'1.5ch'}
									style="color: var(--accent)"
								/>
							</div>
							<p style="color: var(--secondary-light)">
								{e.website}
							</p>
							<p>
								{e.branch + ' '} {e.campus + ' '} {e.batch}
							</p>
						</div>
					</div>
				</a>
			))
		}
	</div>
</>

<style>
	.member-list {
		--x-padding: 0.75rem;
		grid-template-columns: auto;
		justify-content: space-between;
		margin: 0 calc(var(--x-padding) * -1);
		line-height: 1.5;
		text-decoration: none;
	}
	@media (min-width: 768px) {
		.member-list {
			display: grid;
			grid-template-columns: auto auto auto;
		}
	}

	.member-container {
		padding: 0.75rem var(--x-padding);
		border-radius: 0.2rem;
		color: var(--text);
		text-decoration: none;
		& * {
			margin: 0;
		}
	}

	.member-container:hover {
		background-color: var(--tertiary);
		outline: 1px solid var(--secondary);
		& .name {
			text-decoration: underline;
		}
	}

	.member-container:last-child {
		border-bottom: none;
	}

	.name {
		font-weight: 600;
		text-decoration: none;
		color: var(--accent);
	}

	.icon-container {
		width: 32px;
		height: 32px;
		background-color: var(--tertiary);
		border-radius: 15px;
		display: flex;
		align-items: center;
		justify-content: center;
		flex-shrink: 0;
	}

	.favicon {
		width: 24px;
		height: 24px;
		padding: 4px;
		image-rendering: pixelated;
	}
</style>
